FROM node:20-alpine

WORKDIR /app

# Use pnpm matching the project
RUN corepack enable && corepack prepare pnpm@10.24.0 --activate

# Install deps first for better caching (respect project pnpm config)
COPY package.json pnpm-lock.yaml* .npmrc ./
# Prevent Git hooks during image builds and relax peer dep strictness to avoid
# blocking on optional/devtool peer mismatches inside the container.
RUN HUSKY=0 CI=true pnpm install --strict-peer-dependencies=false

# App source
COPY . .

# Cache node_modules to a separate path so runtime can prime an anonymous volume without reinstalling
RUN cp -a node_modules /opt/node_modules_cache

# Vite dev server
EXPOSE 5173

# Bind to 0.0.0.0 so host can reach it, and keep container port at 5173
# strictPort ensures Vite fails instead of auto-switching, matching our published port
CMD ["pnpm", "dev"]
